#!/usr/bin/env node

/**
 * @file warhorse
 * @description The Warhorse command-line interface (CLI).
 * @author Kyle Alexis Sargeant <kasargeant@gmail.com> {@link https://github.com/kasargeant https://github.com/kasargeant}.
 * @copyright Kyle Alexis Sargeant 2017
 * @license See LICENSE file included in this distribution.
 */

let argv = require("minimist")(process.argv.slice(2), {
    string: "task",
    alias: {h: "help", v: "version"},
    default: {task: "build"},
    "--": true
});
// console.dir(argv);
// /Users/kyle/dev/warhorse
let workingDirectory = process.cwd();
//console.log(`Working directory: ${workingDirectory}`);

const run = require("../src/index");

const commands = ["build", "clean", "create", "distribute", "document", "init", "lint", "pack", "precompile", "test"]; //FIXME - replace with Object.keys(warhorse.tasks);

const help = `
  ============================================================================
  WARHORSE HELP SHEET
  
	Usage
	  $ warhorse <flags> <command> <options>

	Commands
	  build,         Builds the project in the current directory.
	  create,        Initialises and creates a new project interactively in a named sub-directory.
	  distribute,    Makes a final distribution build of the project in the ./dist directory.
	  document,      Documents the project in the current directory.
	  init,          Initialises and creates a new project in the current directory.
	  precompile,    Precompiles and minimises all style and template assets.

	Flags
	  --config,  -c  Use a specific config file.
	  --help,    -h  Shows this information.
	  --project, -p  Use a specific project convention.
	  --version, -v  Shows Warhorse CLI version.

	Examples
	  $ warhorse init module my-module
	     COMMAND init...
	     
	  $ warhorse build
	     COMMAND build...
	     
	  $ warhorse distribute --config ./conf/.warhorse
	     ðŸŒˆ ...CRUSHING YOUR ENEMIES!!! ðŸŒˆ

  ============================================================================

`;

// Respond to user input
if(argv.help === true) {
    console.log(help);
} else if(argv.version === true) {
    let warhorsePackage = require(workingDirectory + "/" + "package.json");
    console.log(`Warhorse version: ${warhorsePackage.version}`);
} else if(argv._.length > 0) {

    // Determine command
    if(commands.includes(argv._[0])) {
        run(workingDirectory, argv._); // Passes command and rest args
    } else {
        console.log(`Error: Unrecognised command '${argv._[0]}'.`);
        console.log(help);
    }
} else {
    console.log(`Error: Missing any command.`);
    console.log(help);
}
